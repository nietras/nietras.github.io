---
layout: post
title: Sep 0.4.0-0.5.2 - Insanely Fast Single- & Multi-threaded .NET CSV Parsing (up to 35x faster than CsvHelper)
---

As mentioned at the end of [Sep 0.3.0 - Unescape Support (still the Most
Efficient .NET CSV Parser)]({{ site.baseurl }}/2023/11/27/sep-0-3-0/) there was
one big "issue" remaining with regards to Sep being the world's fastest .NET CSV
parser and that was parallelization.

On January 1st, 2024 Sep 0.4.0 was released to address this. This was a major
release with a rewrite of the parser to efficiently support multi-threading.
Surfaced as a new simple to use extension method `ParallelEnumerate` that allows
for parallel enumeration of parsed data from rows like:

```csharp
using var reader = Sep.Reader().FromFile("very-long.csv");
var results = reader.ParallelEnumerate(ParseRow);
foreach (var result in results) { Handle(result); }
```

For more on the API see the [README](https://github.com/nietras/Sep) on GitHub.
Since 0.4.0 there have been multiple other releases (latest being 0.5.2)
including some breaking changes to make the API more consistent. See
[Releases](https://github.com/nietras/Sep/releases) for notes on those changes
which also include various minor new features and not the least a buffer overrun
bug fix, so be sure to update to the currently latest version.

In this blog post I will focus on the new multi-threading support and the insane
performance Sep now offers. Not the least Sep is now "officially" the world's
fastest .NET CSV parser now that [Joel
Verhagen's](https://twitter.com/joelverhagen) has updated his blog post [The
fastest CSV parser in
.NET](https://www.joelverhagen.com/blog/2020/12/fastest-net-csv-parsers) based
on Sep 0.4.0.

## NCsvPerf Package Assets Benchmark - Top 20 Fastest .NET CSV Parsers

Using the numbers from [Joel Verhagen's](https://twitter.com/joelverhagen) blog
post the below charts compare Sep to the other top 20 fastest CSV parsers on
.NET 8 with either [Workstation GC or Server
GC](https://learn.microsoft.com/en-us/dotnet/standard/garbage-collection/workstation-server-gc).
The impact of using server GC is tremendous due the the way the NCsvPerf package
assets benchmark is formulated. It allocates a `class` (reference type) for each
row. And allocating a million of such in a very short time favors a GC tuned for
high throughput (Server GC) over low latency (Workstation GC). Comparing to
[CsvHelper](https://github.com/JoshClose/CsvHelper):

 * Workstation GC: **Sep is 4.7x faster than CsvHelper**
 * Server GC: **Sep is 11.5x faster than CsvHelper**

An unfair comparison given multi-threaded vs single-threaded, but even for
single-threaded Sep is 2-3x faster than CsvHelper. Sep is also faster than all
other parsers, but for single-threaded only by a small margin to
[Sylvan.Data.Csv](https://github.com/MarkPflug/Sylvan/blob/main/docs/Csv/Sylvan.Data.Csv.md).

![Comparing .NET CSV parsers with Workstation GC - Sep 4.7x faster than CsvHelper]({{ site.baseurl }}/images/2024-05-sep/sep-ncsvperf-top-20-workstation-gc.png) 

![Comparing .NET CSV parsers with Server GC - Sep 11.5x faster than CsvHelper]({{ site.baseurl }}/images/2024-05-sep/sep-ncsvperf-top-20-server-gc.png) 

## Floats Benchmark - Sep 35x Faster than CsvHelper

In the Sep repository there is a [benchmark that compares floats
parsing](https://github.com/nietras/Sep?tab=readme-ov-file#floats-reader-comparison-benchmarks)
for `Sep`, `CsvHelper`, `Sylvan.Data.Csv` and a naive `ReadLine` implementation.
Parsing floats is a key usage scenario and the benchmark is used as a daily
driver in the development of Sep. With multi-threading support Sep is now up to
**35x faster than CsvHelper** on an Intel Xeon Silver 4316 with AVX-512 and
almost 5x faster single-threaded.

![Comparing .NET CSV parsers for floats - Sep 35x faster than CsvHelper]({{ site.baseurl }}/images/2024-05-sep/sep-floats.png) 

## ParallelEnumerate Implementation